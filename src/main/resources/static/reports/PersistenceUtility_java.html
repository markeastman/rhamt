<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <title>Source Report for PersistenceUtility.java</title>
    <link href="resources/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="resources/css/windup.css" rel="stylesheet" media="screen"/>
    <link rel="stylesheet" type="text/css" href="resources/libraries/snippet/jquery.snippet.min.css" />
    <link rel="stylesheet" type="text/css" href="resources/css/windup-source.css" />
    <link rel="stylesheet" type="text/css" href="resources/libraries/sausage/sausage.css" />
    <link rel="shortcut icon" href="resources/img/rhamt-icon-128.png" type="image/x-icon"/>
</head>
<body role="document" class="source-report">

    <div class="navbar navbar-default navbar-fixed-top" id="main-navbar" style="display: none">
        <div class="wu-navbar-header navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <span class="wu-navbar-header">
              <strong class="wu-navbar-header">Red Hat Application Migration Toolkit</strong>
            </span>        </div>


                <div class="navbar-collapse collapse navbar-responsive-collapse project-specific" data-project-id="4062208">
    <ul class="nav navbar-nav">
            <li class="">
                <a href="../index.html"><i class="glyphicon glyphicon-home"></i> All Applications</a>
            </li>



                <li class="">
                    <a href="report_index_RHQ_Enterprise_Server_EAR.html">
                        <i class="glyphicon glyphicon-dashboard"></i>
                      Dashboard
                    </a>
                </li>


                <li class="">
                    <a href="migration_issues.1.html">
                        <i class="glyphicon glyphicon-warning-sign"></i>
                      Issues
                    </a>
                </li>


                <li class="">
                    <a href="ApplicationDetails_RHQ_Enterprise_Server_EAR.html">
                        <i class="glyphicon glyphicon-th-list"></i>
                      Application Details
                    </a>
                </li>


                <li class="">
                    <a href="dependency_report_RHQ_Enterprise_Server_EAR.html">
                        <i class="glyphicon glyphicon-compressed"></i>
                      Dependencies
                    </a>
                </li>


                <li class="">
                    <a href="remotereport_RHQ_Enterprise_Server_EAR.html">
                        <i class="glyphicon service-nav-logo"></i>
                      Remote Services
                    </a>
                </li>


                <li class="">
                    <a href="ejbreport_RHQ_Enterprise_Server_EAR.html">
                        <i class="glyphicon ejb-nav-logo"></i>
                      EJBs
                    </a>
                </li>


                <li class="">
                    <a href="jpa_RHQ_Enterprise_Server_EAR.html">
                        <i class="glyphicon jpa-nav-logo"></i>
                      JPA
                    </a>
                </li>


                <li class="">
                    <a href="server_resources_RHQ_Enterprise_Server_EAR.html">
                        <i class="glyphicon server-resource-nav-logo"></i>
                      Server Resources
                    </a>
                </li>


                <li class="">
                    <a href="hardcoded_ipsRHQ_Enterprise_Server_EAR.html">
                        <i class="glyphicon glyphicon-map-marker"></i>
                      Hard-coded IP Addresses
                    </a>
                </li>


                <li class="">
                    <a href="ignoredfiles_RHQ_Enterprise_Server_EAR.html">
                        <i class="glyphicon glyphicon-eye-close"></i>
                      Ignored Files
                    </a>
                </li>


                <li class="">
                    <a href="about_RHQ_Enterprise_Server_EAR.html">
                        <i class="glyphicon glyphicon-info-sign"></i>
                      About
                    </a>
                </li>
    </ul>
    <ul class="nav navbar-nav navbar-right">
<li>
    <a href="#" class="feedback-nav-btn jiraFeedbackTrigger"><i class="glyphicon glyphicon-comment"></i> Send Feedback </a>
</li>


    <script type="text/javascript" src="https://issues.jboss.org/s/f215932e68571747ac58d0f5d554396f-T/en_US-r7luaf/6346/82/1.4.16/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?locale=en-US&amp;collectorId=8b9e338b"></script>

    <script type="text/javascript">

    var FEEDBACK_JS_ADDED = false;
    var FEEDBACK_FORM_TRIGGER = null;

    function displayFeedbackForm() {
        FEEDBACK_FORM_TRIGGER();
    }

    window.ATL_JQ_PAGE_PROPS = {
        "triggerFunction": function(showCollectorDialog) {
            FEEDBACK_FORM_TRIGGER = showCollectorDialog;
        }
    };

    document.addEventListener("DOMContentLoaded", function(event) {
            jQuery(".jiraFeedbackTrigger").click(function(e) {
                e.preventDefault();
                displayFeedbackForm();
            });
    });
    </script>
    </ul>
                </div><!-- /.nav-collapse -->
    </div>


    <div class="container-fluid" role="main">
        <div class="row">
            <div class="page-header page-header-no-border">
                <h1>
                    <div class="main">Source Report</div>

                        <div class="path project-specific" data-project-id="4062208">
                            rhq-enterprise-server-ear-1.3.0.EmbJopr.1.3.0-4.ear/rhq-core-domain-ejb3.jar/org/rhq/core/domain/util/PersistenceUtility.java
                        </div>
                </h1>
                <div class="desc">
                    This report displays what Red Hat Application Migration Toolkit found in individual files.
                    Each item is shown below the line it was found on,
                    and next to it, you may find a link to the rule which it was found by.
                </div>
            </div>
        </div>

        <div class="row">
            <div class="container-fluid theme-showcase" role="main">

                <div class="panel panel-primary">
                    <div class="panel-heading">
                        <h3 class="panel-title">Information</h3>
                    </div>
                    <div class="panel-body" style="overflow: auto;">

                        <!--<div style="height: 120pt; float:left;"></div> Keeps the minimal height. -->
                        <div class="points" style="text-align: center; color: #00254b; padding-bottom: 1ex;">
                            <div class="number">1</div>
                            <div>Story Points</div>
                        </div>

                        <div class="info" style="margin-left: 95pt;">

                            <h4>Technologies</h4>
                            <div class="technologies" style="overflow: auto"><!-- "auto" to contain all the tags. -->
                                    <span class="label label-info" title="INFORMATIONAL">Decompiled Java File</span>
                            </div>



                            <div style="clear: both;"/><!-- Snaps under the height keeper. Yes, the same effect could be achieved by a table. -->
                        </div><!-- .info -->
                    </div>
                </div>



                <pre id="source">
package org.rhq.core.domain.util;

import java.util.ArrayList;
import java.util.Collection;
import java.util.List;
import java.util.regex.Matcher;
import java.util.regex.Pattern;
import javax.management.InstanceAlreadyExistsException;
import javax.management.MBeanServer;
import javax.management.MBeanServerFactory;
import javax.management.ObjectName;
import javax.persistence.EntityManager;
import javax.persistence.Query;
import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;
import org.hibernate.Criteria;
import org.hibernate.Session;
import org.hibernate.SessionFactory;
import org.hibernate.criterion.Criterion;
import org.hibernate.ejb.EntityManagerImpl;
import org.hibernate.engine.NamedQueryDefinition;
import org.hibernate.engine.SessionFactoryImplementor;
import org.hibernate.jmx.StatisticsService;
import org.hibernate.stat.Statistics;
import org.rhq.core.domain.util.OrderingField;
import org.rhq.core.domain.util.PageControl;
import org.rhq.core.domain.util.PageList;
import org.rhq.core.domain.util.PageOrdering;

public class PersistenceUtility {
   private static final Log LOG = LogFactory.getLog(PersistenceUtility.class);
   private static final Pattern COUNT_QUERY_PATTERN = Pattern.compile(&quot;^(\\s*SELECT\\s+)(.*?)(\\s+FROM.*)&quot;, 42);
   private static final Pattern COUNT_QUERY_REMOVE_FETCH = Pattern.compile(&quot;FETCH&quot;, 42);
   public static final String HIBERNATE_STATISTICS_MBEAN_OBJECTNAME = &quot;Hibernate:type=statistics,application=RHQ&quot;;

   public static Query createQueryWithOrderBy(EntityManager entityManager, String queryName, PageControl pageControl) {
      Query query;
      if(pageControl.getPrimarySortColumn() != null) {
         query = createQueryWithOrderBy(entityManager, queryName, pageControl.getOrderingFieldsAsArray());
      } else {
         StackTraceElement caller = (new Throwable()).fillInStackTrace().getStackTrace()[1];
         LOG.warn(&quot;Queries should really supply default sort columns. Caller did not: &quot; + caller);
         query = entityManager.createNamedQuery(queryName);
      }

      setDataPage(query, pageControl);
      return query;
   }

   public static Query createQueryWithOrderBy(EntityManager entityManager, String queryName, OrderingField... orderByFields) {
      NamedQueryDefinition ndc = getNamedQueryDefinition(entityManager, queryName);
      StringBuilder query = new StringBuilder(ndc.getQueryString());
      buildOrderBy(query, orderByFields);
      return entityManager.createQuery(query.toString());
   }

   public static Query createNonNamedQueryWithOrderBy(EntityManager entityManager, String queryText, PageControl pageControl) {
      Query query;
      if(pageControl.getPrimarySortColumn() != null) {
         query = createNonNamedQueryWithOrderBy(entityManager, queryText, pageControl.getOrderingFieldsAsArray());
      } else {
         StackTraceElement caller = (new Throwable()).fillInStackTrace().getStackTrace()[1];
         LOG.warn(&quot;Queries should really supply default sort columns. Caller did not: &quot; + caller);
         query = entityManager.createQuery(queryText);
      }

      setDataPage(query, pageControl);
      return query;
   }

   public static Query createNonNamedQueryWithOrderBy(EntityManager entityManager, String queryText, OrderingField... orderByFields) {
      StringBuilder query = new StringBuilder(queryText);
      buildOrderBy(query, orderByFields);
      return entityManager.createQuery(query.toString());
   }

   private static StringBuilder buildOrderBy(StringBuilder query, OrderingField... orderByFields) {
      boolean first = true;
      OrderingField[] arr$ = orderByFields;
      int len$ = orderByFields.length;

      for(int i$ = 0; i$ &lt; len$; ++i$) {
         OrderingField orderingField = arr$[i$];
         if(first) {
            query.append(&quot; ORDER BY &quot;);
            first = false;
         } else {
            query.append(&quot;, &quot;);
         }

         query.append(orderingField.getField()).append(&quot; &quot;).append(orderingField.getOrdering());
      }

      return query;
   }

   private static String getOrderByFragment(OrderingField... orderByFields) {
      boolean first = true;
      StringBuilder builder = new StringBuilder();
      OrderingField[] arr$ = orderByFields;
      int len$ = orderByFields.length;

      for(int i$ = 0; i$ &lt; len$; ++i$) {
         OrderingField orderingField = arr$[i$];
         if(first) {
            builder.append(&quot; ORDER BY &quot;);
            first = false;
         } else {
            builder.append(&quot;, &quot;);
         }

         builder.append(orderingField.getField()).append(&quot; &quot;).append(orderingField.getOrdering());
      }

      return builder.toString();
   }

   public static Query createCountQuery(EntityManager em, String queryName) {
      return createCountQuery(em, queryName, &quot;*&quot;);
   }

   public static Query createCountQuery(EntityManager entityManager, String queryName, String countItem) {
      NamedQueryDefinition namedQueryDefinition = getNamedQueryDefinition(entityManager, queryName);
      String query = namedQueryDefinition.getQueryString();
      Matcher matcher = COUNT_QUERY_PATTERN.matcher(query);
      if(!matcher.find()) {
         throw new RuntimeException(&quot;Unable to transform query into count query [&quot; + queryName + &quot; - &quot; + query + &quot;]&quot;);
      } else {
         String newQuery = matcher.group(1) + &quot;COUNT(&quot; + countItem + &quot;)&quot; + matcher.group(3);
         matcher = COUNT_QUERY_REMOVE_FETCH.matcher(newQuery);
         if(matcher.find()) {
            StringBuffer buffer = new StringBuffer();

            do {
               matcher.appendReplacement(buffer, &quot;&quot;);
            } while(matcher.find());

            matcher.appendTail(buffer);
            newQuery = buffer.toString();
         }

         if(LOG.isTraceEnabled()) {
            LOG.trace(&quot;Transformed query to count query [&quot; + queryName + &quot;] resulting in [&quot; + newQuery + &quot;]&quot;);
         }

         return entityManager.createQuery(newQuery);
      }
   }

   public static void setDataPage(Query query, PageControl pageControl) {
      if(pageControl.getPageSize() &gt; 0) {
         query.setFirstResult(pageControl.getStartRow());
         query.setMaxResults(pageControl.getPageSize());
      }

   }

   public static String formatSearchParameter(String value) {
      return value != null &amp;&amp; !value.trim().equals(&quot;&quot;)?&quot;%&quot; + value.replaceAll(&quot;\\_&quot;, &quot;\\\\_&quot;).toUpperCase() + &quot;%&quot;:null;
   }

   public static PageList createPaginationFilter(EntityManager entityManager, Collection collection, PageControl pageControl) {
      if(collection == null) {
         return new PageList(pageControl);
      } else {
         String filter = &quot;&quot;;
         if(pageControl.getPrimarySortColumn() != null) {
            PageOrdering query = pageControl.getPrimarySortOrder() == null?PageOrdering.ASC:pageControl.getPrimarySortOrder();
            filter = buildOrderBy(new StringBuilder(), new OrderingField[]{new OrderingField(pageControl.getPrimarySortColumn(), query)}).toString();
         }

         org.hibernate.Query query1 = getHibernateSession(entityManager).createFilter(collection, filter);
         if(pageControl.getPageSize() &gt; 0) {
            query1.setFirstResult(pageControl.getPageNumber() * pageControl.getPageSize());
            query1.setMaxResults(pageControl.getPageSize());
         }

         getHibernateSession(entityManager).flush();
         return new PageList(query1.list(), pageControl);
      }
   }

   public static List findByCriteria(EntityManager entityManager, Class type, Criterion... criterion) {
      Criteria crit = getHibernateSession(entityManager).createCriteria(type);
      Criterion[] arr$ = criterion;
      int len$ = criterion.length;

      for(int i$ = 0; i$ &lt; len$; ++i$) {
         Criterion c = arr$[i$];
         crit.add(c);
      }

      return crit.list();
   }

   public static Session getHibernateSession(EntityManager entityManager) {
      Session session;
      if(entityManager.getDelegate() instanceof EntityManagerImpl) {
         EntityManagerImpl entityManagerImpl = (EntityManagerImpl)entityManager.getDelegate();
         session = entityManagerImpl.getSession();
      } else {
         session = (Session)entityManager.getDelegate();
      }

      return session;
   }

   public static void enableHibernateStatistics(EntityManager entityManager, MBeanServer server) {
      try {
         SessionFactory e = getHibernateSession(entityManager).getSessionFactory();
         if(server == null) {
            ArrayList objectName = MBeanServerFactory.findMBeanServer((String)null);
            server = (MBeanServer)objectName.get(0);
         }

         ObjectName objectName1 = new ObjectName(&quot;Hibernate:type=statistics,application=RHQ&quot;);
         StatisticsService mBean = new StatisticsService();
         mBean.setSessionFactory(e);
         server.registerMBean(mBean, objectName1);
         e.getStatistics().setStatisticsEnabled(true);
      } catch (InstanceAlreadyExistsException var5) {
         LOG.info(&quot;Duplicate mbean registration ignored: Hibernate:type=statistics,application=RHQ&quot;);
      } catch (Exception var6) {
         LOG.warn(&quot;Couldn\'t register hibernate statistics mbean&quot;, var6);
      }

   }

   public static Statistics getStatisticsService(EntityManager entityManager, MBeanServer server) {
      Session hibernateSession = getHibernateSession(entityManager);
      SessionFactory hibernateSessionFactory = hibernateSession.getSessionFactory();
      Statistics hibernateStatistics = hibernateSessionFactory.getStatistics();
      return hibernateStatistics;
   }

   public static String getQueryDefinitionFromNamedQuery(EntityManager entityManager, String queryName) {
      NamedQueryDefinition ndc = getNamedQueryDefinition(entityManager, queryName);
      return ndc.getQueryString();
   }

   private static NamedQueryDefinition getNamedQueryDefinition(EntityManager entityManager, String queryName) {
      SessionFactoryImplementor sessionFactory = getHibernateSessionFactoryImplementor(entityManager);
      NamedQueryDefinition namedQueryDefinition = sessionFactory.getNamedQuery(queryName);
      if(namedQueryDefinition == null) {
         throw new RuntimeException(&quot;EJB3 query not found [&quot; + queryName + &quot;]&quot;);
      } else {
         return namedQueryDefinition;
      }
   }

   private static SessionFactoryImplementor getHibernateSessionFactoryImplementor(EntityManager entityManager) {
      Session session = getHibernateSession(entityManager);
      SessionFactoryImplementor sessionFactory = (SessionFactoryImplementor)session.getSessionFactory();
      return sessionFactory;
   }

   public static String addPostgresNativePagingSortingToQuery(String query, PageControl pageControl) {
      return addLimitOffsetToQuery(query, pageControl);
   }

   public static String addOracleNativePagingSortingToQuery(String query, PageControl pageControl) {
      StringBuilder queryWithPagingSorting = new StringBuilder(query.length() + 50);
      int minRowNum = pageControl.getStartRow() + 1;
      int maxRowNum = minRowNum + pageControl.getPageSize() - 1;
      queryWithPagingSorting.append(&quot;SELECT outerResults.* FROM ( &quot;);
      queryWithPagingSorting.append(&quot;SELECT innerResults.*, ROWNUM rnum FROM ( &quot;);
      queryWithPagingSorting.append(query);
      buildOrderBy(queryWithPagingSorting, pageControl.getOrderingFieldsAsArray());
      queryWithPagingSorting.append(&quot; ) innerResults &quot;);
      queryWithPagingSorting.append(&quot; WHERE ROWNUM &lt;= &quot;).append(maxRowNum);
      queryWithPagingSorting.append(&quot; ) outerResults &quot;);
      queryWithPagingSorting.append(&quot; WHERE rnum &gt;= &quot;).append(minRowNum);
      return queryWithPagingSorting.toString();
   }

   public static String addSQLServerNativePagingSortingToQuery(String query, PageControl pageControl) {
      return addSQLServerNativePagingSortingToQuery(query, pageControl, false);
   }

   public static String addSQLServerNativePagingSortingToQuery(String query, PageControl pageControl, boolean alternatePagingStyle) {
      StringBuilder queryWithPagingSorting = new StringBuilder(query.length() + 50);
      int minRowNum = pageControl.getStartRow() + 1;
      int maxRowNum = minRowNum + pageControl.getPageSize() - 1;
      String orderByClause = getOrderByFragment(pageControl.getOrderingFieldsAsArray());
      if(alternatePagingStyle) {
         int index = findSelectListEndIndex(query);
         String selectList = query.substring(0, index);
         String restOfQuery = query.substring(index);
         queryWithPagingSorting.append(&quot;SELECT singleResults.* FROM ( &quot;);
         queryWithPagingSorting.append(selectList);
         queryWithPagingSorting.append(&quot;, ROW_NUMBER() OVER( &quot; + orderByClause + &quot; ) AS rownum &quot;);
         queryWithPagingSorting.append(restOfQuery);
         queryWithPagingSorting.append(&quot;) AS singleResults &quot;);
      } else {
         queryWithPagingSorting.append(&quot;SELECT outerResults.* FROM ( &quot;);
         queryWithPagingSorting.append(&quot;   SELECT innerResults.*, &quot;);
         queryWithPagingSorting.append(&quot;          ROW_NUMBER() OVER( &quot; + orderByClause + &quot; ) AS rownum &quot;);
         queryWithPagingSorting.append(&quot;   FROM ( &quot; + query + &quot; ) AS innerResults &quot;);
         queryWithPagingSorting.append(&quot; ) AS outerResults &quot;);
      }

      queryWithPagingSorting.append(&quot;WHERE rownum &lt;= &quot;).append(maxRowNum);
      queryWithPagingSorting.append(&quot; AND rownum &gt;= &quot;).append(minRowNum);
      return queryWithPagingSorting.toString();
   }

   private static int findSelectListEndIndex(String query) {
      int nesting = 0;
      query = query.toLowerCase();
      StringBuilder wordBuffer = new StringBuilder();

      for(int i = 0; i &lt; query.length(); ++i) {
         char next = query.charAt(i);
         if(next == 40) {
            ++nesting;
         } else if(next == 41) {
            --nesting;
         } else if(nesting == 0) {
            if(Character.isLetter(next)) {
               wordBuffer.append(next);
               if(wordBuffer.toString().equals(&quot;from&quot;)) {
                  return i - 4;
               }
            } else {
               wordBuffer.setLength(0);
            }
         }
      }

      throw new IllegalArgumentException(&quot;Could not find select list end index&quot;);
   }

   public static String addH2NativePagingSortingToQuery(String query, PageControl pageControl) {
      return addLimitOffsetToQuery(query, pageControl);
   }

   private static String addLimitOffsetToQuery(String query, PageControl pageControl) {
      StringBuilder queryWithPagingSorting = new StringBuilder(query.length() + 50);
      queryWithPagingSorting.append(query);
      buildOrderBy(queryWithPagingSorting, pageControl.getOrderingFieldsAsArray());
      queryWithPagingSorting.append(&quot; LIMIT &quot;).append(pageControl.getPageSize());
      queryWithPagingSorting.append(&quot; OFFSET &quot;).append(pageControl.getStartRow());
      return queryWithPagingSorting.toString();
   }
}
</pre>
            </div> <!-- /container -->
        </div><!-- /row-->
    </div><!-- /container main-->


<div style="text-align: left; font-size: small; color: gray; font-style: italic;">Page generated: Sep 8, 2017 11:31:14 AM</div>
    <script src="resources/js/jquery-1.10.1.min.js"></script>
    <script src="resources/js/jquery-migrate-1.4.1.min.js"></script>
    <script src="resources/js/bootstrap.min.js"></script>

    <script type="text/javascript" src="resources/libraries/jquery-ui/jquery.ui.widget.js"></script>
    <script type="text/javascript" src="resources/libraries/snippet/jquery.snippet.min.js"></script>
    <script type="text/javascript" src="resources/libraries/snippet/jquery.snippet.java-properties.js"></script>
    <script type="text/javascript" src="resources/libraries/snippet/jquery.snippet.java-manifest.js"></script>
    <script type="text/javascript" src="resources/libraries/sausage/jquery.sausage.min.js"></script>

    <script type="text/javascript">
        var script   = document.createElement("script");
        script.type  = "text/javascript";
            script.src   = "resources/js/navbar.js";
        document.body.appendChild(script);
    </script>

    <script type="text/javascript">
        $(window).on("hashchange", function () {
            window.scrollTo(window.scrollX, window.scrollY - 50);
        });
        function offsetAnchor() {
            if(location.hash.length !== 0) {
                window.scrollTo(window.scrollX, window.scrollY - 50);
            }
        }
        window.setTimeout(function() {
            offsetAnchor();
        }, 1);
        $(document).ready(function(){
            $("pre").snippet("java",{style:"ide-eclipse", showNum:true,boxFill:"#ffeeb9", box: "216" });

            $("<div id='216-inlines' class='inline-source-hint-group'/>").appendTo('ol.snippet-num li:nth-child(216)');


$("<a name='12267776' class='windup-file-location'></a><div class='inline-source-comment green tag-jmx'><div class='inline-comment'><div class='inline-comment-heading'><strong class='notification warning'>JMX MBean object name (javax.management.ObjectName)</strong><a title='View Rule: environment-dependent-calls-04000' href='windup_ruleproviders.html#environment-dependent-calls-04000'><span class='glyphicon glyphicon-link rule-link floatRight'></span></a></div><div class='inline-comment-body'><p>After migration, some of the JMX beans provided by the previous server may not be present anymore. Ensure that the <code>javax.management.ObjectName<\/code> does not need to change for JBoss.<\/p></div></div></div>").appendTo('#216-inlines');


            $('code[class]').each(function(){
                 var codeSyntax = ($(this).attr('class'));
                 if(codeSyntax) {
                    $(this).parent().snippet(codeSyntax,{style:'ide-eclipse', menu:false, showNum:false});
                 }
            });
            $(window).sausage({ page: 'li.box' });
        });

        function qs(key) {
            key = key.replace(/[*+?^$.\[\]{}()|\\\/]/g, "\\$&"); // escape RegEx meta chars
            var match = location.search.match(new RegExp("[?&]"+key+"=([^&]+)(&|$)"));
            return match && decodeURIComponent(match[1].replace(/\+/g, " "));
        }

        $(document).ready(function() {
            var defaultProjectID = 4062208;
            var selectedProject = qs("project");
            if (!selectedProject)
                selectedProject = defaultProjectID;

            $(".project-specific").each(function(index, element) {
                var currentProject = $(element).data("project-id");

                if (currentProject == selectedProject)
                    $(element).show();
                else
                    $(element).remove();
            });
            $("#main-navbar").show();
        });
    </script>

</body>
</html>
